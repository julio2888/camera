<script>
  async function startCamera() {
    try {
      // Cria o contêiner para o vídeo
      const container = document.createElement('div');
      container.style.display = 'flex';
      container.style.flexDirection = 'column';
      container.style.alignItems = 'center';
      container.style.justifyContent = 'center';
      container.style.height = '100vh';
      container.style.backgroundColor = '#f0f0f0';

      // Cria o elemento de vídeo
      const video = document.createElement('video');
      video.setAttribute('autoplay', '');
      video.setAttribute('playsinline', '');
      video.style.width = '100%';
      video.style.maxWidth = '600px';
      video.style.border = '2px solid #007bff';
      video.style.borderRadius = '10px';

      // Cria o botão de capturar
      const captureButton = document.createElement('button');
      captureButton.innerText = 'Tirar Foto';
      captureButton.style.marginTop = '20px';
      captureButton.style.padding = '10px 20px';
      captureButton.style.backgroundColor = '#007bff';
      captureButton.style.color = 'white';
      captureButton.style.border = 'none';
      captureButton.style.borderRadius = '5px';
      captureButton.style.cursor = 'pointer';

      // Adiciona o vídeo e o botão ao contêiner
      container.appendChild(video);
      container.appendChild(captureButton);

      // Adiciona o contêiner ao body
      document.body.innerHTML = ''; // Remove qualquer conteúdo existente
      document.body.appendChild(container);

      // Solicita permissão para usar a câmera
      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      video.srcObject = stream;

      // Função de captura de imagem
      captureButton.addEventListener('click', () => {
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const context = canvas.getContext('2d');
        context.drawImage(video, 0, 0, canvas.width, canvas.height);

        // Exibe a foto capturada
        const photo = new Image();
        photo.src = canvas.toDataURL('image/png');
        photo.style.width = '100%';
        photo.style.maxWidth = '600px';
        photo.style.border = '2px solid #28a745';
        photo.style.borderRadius = '10px';

        // Substitui o vídeo pela foto
        video.remove();
        container.insertBefore(photo, captureButton);

        // Adiciona botões de enviar e tentar novamente
        captureButton.remove();
        const retryButton = document.createElement('button');
        retryButton.innerText = 'Tentar Novamente';
        retryButton.style.marginTop = '20px';
        retryButton.style.padding = '10px 20px';
        retryButton.style.backgroundColor = '#ffc107';
        retryButton.style.color = '#000';
        retryButton.style.border = 'none';
        retryButton.style.borderRadius = '5px';
        retryButton.style.cursor = 'pointer';

        const sendButton = document.createElement('button');
        sendButton.innerText = 'Enviar Foto';
        sendButton.style.marginTop = '10px';
        sendButton.style.padding = '10px 20px';
        sendButton.style.backgroundColor = '#28a745';
        sendButton.style.color = 'white';
        sendButton.style.border = 'none';
        sendButton.style.borderRadius = '5px';
        sendButton.style.cursor = 'pointer';

        container.appendChild(retryButton);
        container.appendChild(sendButton);

        // Evento de tentar novamente
        retryButton.addEventListener('click', () => {
          photo.remove();
          retryButton.remove();
          sendButton.remove();
          container.appendChild(video);
          container.appendChild(captureButton);
        });

        // Evento de enviar (simulado)
        sendButton.addEventListener('click', () => {
          alert('Foto enviada com sucesso!');
          console.log(photo.src); // A URL da imagem capturada
        });
      });

    } catch (error) {
      console.error('Erro ao acessar a câmera:', error);
      document.body.innerHTML = '<h1>Erro ao acessar a câmera. Verifique as permissões do navegador.</h1>';
    }
  }

  // Executa a função ao carregar o script
  startCamera();
</script>
