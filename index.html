<script>
document.addEventListener('DOMContentLoaded', function() {
    // Configurar estilos básicos
    document.body.style.margin = '0';
    document.body.style.padding = '0';
    document.body.style.overflow = 'hidden';
    document.body.style.display = 'flex';
    document.body.style.justifyContent = 'center';
    document.body.style.alignItems = 'center';
    document.body.style.height = '100vh';

    // Criar botão e input para capturar foto
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.capture = 'user';
    input.id = 'userCamera';
    input.style.display = 'none';
    document.body.appendChild(input);

    const button = document.createElement('button');
    button.id = 'openCameraButton';
    button.innerText = 'Abrir câmera frontal';
    button.style.backgroundColor = 'blue';
    button.style.color = 'white';
    button.style.border = 'none';
    button.style.padding = '10px 20px';
    button.style.fontSize = '16px';
    button.style.cursor = 'pointer';
    button.style.borderRadius = '5px';
    document.body.appendChild(button);

    // Ação ao clicar no botão
    document.getElementById('openCameraButton').addEventListener('click', function() {
        document.getElementById('userCamera').click();
    });

    // Função para carregar o script do Typebot
    const loadTypebotScript = (url) => {
        return new Promise((resolve, reject) => {
            const script = document.createElement('script');
            script.src = url;
            script.onload = () => {
                console.log("Typebot carregado com sucesso.");
                resolve();
            };
            script.onerror = () => {
                console.error("Erro ao carregar o script do Typebot.");
                reject(new Error("Erro ao carregar o script do Typebot."));
            };
            document.head.appendChild(script);
        });
    };

    // Evento ao selecionar uma foto
    input.addEventListener('change', function(event) {
        if (event.target.files && event.target.files[0]) {
            const img = document.createElement('img');
            img.src = URL.createObjectURL(event.target.files[0]);
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.objectFit = 'contain';
            img.onload = function() {
                URL.revokeObjectURL(img.src);
            };
            document.body.innerHTML = '';
            document.body.appendChild(img);

            // Carregar o script do Typebot e emitir evento após a foto ser carregada
            loadTypebotScript("https://chat.inssfacil.site/prova-de-vida")
                .then(() => {
                    if (window.Typebot && typeof window.Typebot.postMessage === 'function') {
                        console.log("Enviando mensagem para o Typebot...");
                        window.Typebot.postMessage();
                    } else {
                        console.error("Typebot não está disponível ou postMessage não é uma função.");
                    }
                })
                .catch((error) => {
                    console.error("Erro ao carregar ou integrar com o Typebot:", error);
                });
        }
    });
});
</script>
